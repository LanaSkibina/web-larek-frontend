# Проектная работа "Веб-ларек"

Проект представляет собой интернет-магазин с товарами для веб-разработчиков - Web-ларёк. Используя реализованный функционал, можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ. 

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура проекта

Архитектура проекта пострена на основе реализации паттерна MVP(Model-View-Presenter). 

Данный подход предполагает разделение кода на 3 слоя:
- Слой данных (Model): содержит значительную часть бизнес-логики и отвечает за хранение и изменения данных;
- Слой отображения (View): отвечает за интерфейс для взаимодействия с пользователем;
- Слой представления (Presenter): слой-посредник, который отвечает за взаимодействие данных и представления.

## Базовый код

### Класс Api 

Базовый класс для отправки и получения запросов. 
В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов:
- baseUrl - базовый адрес сервера;
- options - объект с заголовками запросов.

Методы:
- handleResponse - принимает ответ от сервера как параметр, и обрабатывает его;
- get - выполняет запрос на переданный в параметрах ендпоинт и возвращает промис с объектом,которым ответил сервер;
- post - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. 

### Класс EventEmitter 

Брокер событий. Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события.

Поля:
_events: Map - коллекция событий.

Для обратки событий используются следующие методы:
- on - подписка на событие;
- off - отписка от события;
- emit - уведомление подписчиков о наступлении события;
- onAll - подписка одновременно на все события;
- offAll - сброс всех обработчиков;
- trigger - генерирует заданное событие с заданными аргументами.

### Класс Component v

Абстрактный класс для работы с компонентами отображения. Используется для создания компонентов пользовательского интерфейса.
Конструктор: 
- принимает на вход элемент контейнера, типа HTMLElement, в который будет помещен созданный компонент.

Методы:
- setText - установка текста для переданного в конструктор элемента;
- setImage - устанавка изображения для переданного в конструктор элемента (alt - описание для изображения устанавливается опционально);
- setDisabled - блокировка для переданного элемента;
- setHidden/setVisible - скрывает, отображает переданный элемент;
- toggleClass - переключает класс;
- render - собирает компонент, используя переданные данные.

### Класс Model 

Абстрактный класс, который хранит общие поля и методы для классов слоя данных.

Конструктор класса принимает два параметра: 
- объект, который представляет данные модели; 
- экземпляр класса EventEmitter(IEvents), который запустит событие при изменении данных.

Метод:
emitChanges - генерирует события, которые уведомляют подписчиков об изменениях в модели данных 


## Слой данных (Model)

### Класс AppState 

Класс AppState наследуется от абстрактного класса Model и отвечает за состояние данных приложения и методы работы с ними. 

Конструктор: также как и в абстрактном классе, принимает данные модели и экземпляр брокера событий.
Поля:
- catalog - массив товаров;
- basket - массив товаров, добавленных пользователем в корзину;
- order - данные о заказе;
- formErrors - хранит объект с сообщениями об ошибках при оформлении заказа.

Методы:
- setCatalog - устанавливает каталог товаров;
- addToBasket - добавляет товар в корзину;
- addOrderId - добавляет id товара в заказ;
- removeOrderId - удалеяет id товара из заказа;
- removeFromBasket - удаляет товар из корзины;
- isInBasket - проверяет наличие переданного товара в корзине;
- clearBasket - очищает всю корзину;
- getTotal - получение общей суммы заказа;
- setOrderField - устанавливает поле заказа;
- setContactsField - устанавливает поле формы контактов
- validateOrderForm - валидация формы cо способом оплаты и адресом;
- validateContactsForm - валидация формы с телефоном и email;
- isEmpty - заполнение корзины.


## Слой отображения (View)

### Класс Page 

Наследует абстрактный класс Component и отвечает за отображение главной страницы сайта с каталогом товаров и счетчиком товаров в корзине.

Поля:
- _counter - счетчика товаров в корзине;
- _catalog - список товаров для покупки;
- _wrapper - контейнер-обертка страницы;
- _basket - кнопка перехода в корзину.

Методы:
- set counter - устанавливает значение счетчика товаров в корзине;
- set catalog  - устанавливает содержимое каталога;
- set locked - блокирует прокрутку страницы при открытии модального окна.

### Класс Modal 

Наследует абстрактный класс Component. Класс Modal отвечает за отображение и взаимодействие с модальным окном в пользовательском интерфейсе.

Поля:
- принимает на вход элемент контейнера, типа HTMLElemen (класс Component);
- элемент кнопки закрытия;
- экземпляр брокера событий

Методы:
- set content - метод установки содержимого модального окна;
- open - метод открытия модального окна;
- close - метод закрытия модального окна;
- render - метод сборки модального окна с установленным содержимым.

### Класс Form 

Наследует абстрактный класс Component. Класс Form описывает компонент формы и реализует методы для управления состоянием и валидацией формы.

Поля:
- принимает на вход элемент контейнера, типа HTMLElemen (класс Component);
- экземпляр брокера событий.

Методы:
- valid - метод для установки флага валидности формы;
- errors - метод для установки ошибки формы;
- onInputChange - генерация события уведомления подписчиков об изменении значения в формы
- render - сборка формы с новым состоянием.

### Класс Basket 

Наследует абстрактный класс Component. Класс Basket описывает корзину пользователя. Содержит список товаров, добавленных пользователем в корзину, и методы для изменения отображения корзины. 

Конструктор:
- принимает на вход элемент контейнера, типа HTMLElemen (класс Component);
- экземпляр брокера событий.

Поля:
- _list - список товаров в корзине;
- _total - поле с общей суммой заказа;
- _button - кнопка оформления.

Методы: 
- total - сеттер для установки общей суммы заказа;
- selected - сеттер для установки выбранных элементов в корзине;
- items - cеттер для установки списка элементов в корзине.

### Класс Card 

Наследует абстрактный класс Component и отвечает за отображение карточки товара в интерфейсе пользователя. 

Поля:
- _title - заголовок карточки;
- _image - изображение товара в карточке;
- _price - элемент цена товара в карточке;
- _category - элемент категория товара в карточке.

Методы:
- set id - метод установления идентификатора карточки;
- get id - метод получения идентификатора карточки;
- set title - метод установления заголовка;
- set image - метод установления значения изображения;
- set price - метод установления значения цены;
- set category - метод установления категории в карточке.

### Класс CardPreview 

Расширяет класс Card. Отвечает за отображение карточки товара в модальном окне.

Поля:
- index - индекс карточки;
- description - описание товара в карточке;
- _button - кнопка добавления в корзину.

Методы:
- set index - метод установления индекса карточки;
- set description - метод установления описания товара в карточке.

### Класс OrderForm 

Отвечает за отображение формы заказа c адресом и выбором способа платежа.
Является дочерним классом класса Form. Наследует Component. На вход принимает контейнер с формой и брокер событий плюс кнопки:
- кнопка выбора оплаты Онлайн;
- кнопка выбора оплатой при Получении;
- _address - инпут с адресом.

Методы:
- set payment - устанавливает классы для кнопок в зависимости от переданного типа оплаты;
- set address - меняет содержимое поля address в инпуте формы.

### Класс ContactsForm

Отвечает за отображение формы с контактами пользователя. 
Является дочерним классом класса Form. Конструктор наследуется от абстрактного класса родительского класса Form.

Методы:
- set phone - установливает значения поля ввода телефона пользователя;
- set email - устанавливает значение поля электронного адреса пользователя.

### Класс Success 

Наследует абстрактный класс Component. Класс Success ответчает за отображение модального окна с информацией об успешном оформлении заказа и списании средств со счета.

Поля:
- DOM-элемент, в котором будет отрисовываться модальное окно успешного заказа;
- _close - элемент кнопки закрытия окна;
- _total - сообщение о списании суммы.

Метод:
- set total - метод установления общей суммы заказа, которая была списана со счета.

## Класс LarekApi 

Расширяет базовый класс Api для работы с API приложения WebLarek. Конструктор наследуется от базового класса Api.

Поля:
- cdn - адрес сервера с контентом.

Методы:
- getProductList - геттер для полуяения списка товаров с сервера;
- createOrder - отправляет переданный заказ на сервер.


## Слой представления (Presenter)

Взаимодействие между слоем отображения и слоем данных происходит за счет событий, отслеживаемых с помощью брокера событий и обработчиков этих событий. Код, описывающий это взаимодействие расположен в файле index.ts.

### События в приложении

#### События изменения данных

- items:changed - изменение массива товаров каталога
- formErrors:change - изменение в списке ошибок валидации формы

#### События интерфейса 

- modal:open - открытие модального окна
- modal:close - закрытие модального окна
- basket:open - корзина открыта
- order:open - открытие окна оформления заказа
- order:ready - готов к отправке (провалидирован) 
- payment:change - изменение способа оплаты
- ${form}:submit - отправка формы 
- ${form}.${field}:change - изменение поля в форме


## Интерфейсы

- IProduct - интерфейс товара
- ICard - интерфейс карточки товара
- IAppState - интерфейс модели данных
- IEvents - интерфейс экземпляра брокера событий
- IPage - интерфейс страницы
- IBasket - интерфейс корзины
- IModal - интерфейс модального окна
- IForm - интерфейс формы
- IOrder - интерфейс формы заказа
- IContactsForm - интерфейс для формы заказа с контактами пользователя
- IOrderForm - интерфейс формы с методами оплаты и адресом доставки заказа
- ILarekApi - интерфейс для работы с API приложения WebLarek
- IOrderResult - интерфейс результата отправки заказа

## Типы данных

- FormErrors - тип для представления ошибок в форме заказа

